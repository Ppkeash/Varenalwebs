{% comment %}
  VARENAL Reviews Section
  Social proof with stats bar + 6 review cards.
  Animated countUp stats and staggered card entrance.
{% endcomment %}

<section id="reviews" class="varenal-reviews" {{ section.shopify_attributes }}>
  <div class="varenal-section">

    {%- comment -%} Header {%- endcomment -%}
    <div class="reviews__header animate-on-scroll" data-delay="0">
      <span class="varenal-badge reviews__eyebrow">
        {{ section.settings.eyebrow | default: 'REAL RESULTS' }}
      </span>
      <h2 class="reviews__heading">
        {{ section.settings.heading | default: 'Join 2,300+ People Who Finally Found Relief' }}
      </h2>
    </div>

    {%- comment -%} Stats Bar {%- endcomment -%}
    <div class="reviews__stats animate-on-scroll" data-delay="1" id="reviews-stats">
      <div class="reviews__stat">
        <span class="reviews__stat-number" data-count-target="4.9" data-count-decimal="1">0</span>
        <span class="reviews__stat-label">
          <span class="reviews__stat-stars" aria-label="5 estrellas">
            {%- for i in (1..5) -%}
              <svg width="16" height="16" viewBox="0 0 24 24" fill="#00B4C8" aria-hidden="true"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
            {%- endfor -%}
          </span>
          Puntuación media
        </span>
      </div>
      <div class="reviews__stat">
        <span class="reviews__stat-number" data-count-target="2300" data-count-suffix="+">0</span>
        <span class="reviews__stat-label">Reseñas verificadas</span>
      </div>
      <div class="reviews__stat">
        <span class="reviews__stat-number" data-count-target="98" data-count-suffix="%">0</span>
        <span class="reviews__stat-label">Lo recomendarían</span>
      </div>
    </div>

    {%- comment -%} Reviews Grid {%- endcomment -%}
    <div class="reviews__grid">

      {%- comment -%} Card 1 {%- endcomment -%}
      <div class="reviews__card animate-on-scroll" data-delay="1">
        <div class="reviews__card-top">
          <div class="reviews__avatar reviews__avatar--teal">SM</div>
          <div class="reviews__card-meta">
            <span class="reviews__name">Sarah M.</span>
            <span class="reviews__verified">✓ Compra verificada</span>
          </div>
        </div>
        <div class="reviews__stars" aria-label="5 de 5 estrellas">
          {%- for i in (1..5) -%}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="#00B4C8" aria-hidden="true"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
          {%- endfor -%}
        </div>
        <h4 class="reviews__title">Me cambió la vida en mis turnos</h4>
        <p class="reviews__body" data-review-body>Soy enfermera y estoy de pie más de 12 horas al día. Después de la primera sesión, literalmente lloré de alivio. El calor es increíble y se mantiene en su lugar todo el tiempo. No puedo recomendarlo lo suficiente.</p>
        <span class="reviews__date">Enero 2026</span>
      </div>

      {%- comment -%} Card 2 {%- endcomment -%}
      <div class="reviews__card animate-on-scroll" data-delay="2">
        <div class="reviews__card-top">
          <div class="reviews__avatar reviews__avatar--orange">JT</div>
          <div class="reviews__card-meta">
            <span class="reviews__name">James T.</span>
            <span class="reviews__verified">✓ Compra verificada</span>
          </div>
        </div>
        <div class="reviews__stars" aria-label="5 de 5 estrellas">
          {%- for i in (1..5) -%}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="#00B4C8" aria-hidden="true"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
          {%- endfor -%}
        </div>
        <h4 class="reviews__title">Mejor que mis visitas al fisio</h4>
        <p class="reviews__body" data-review-body>Me torcí el tobillo jugando baloncesto. Este dispositivo redujo mi recuperación a la mitad. La combinación de vibración y calor es otra cosa — mi fisio literalmente me preguntó qué estaba usando.</p>
        <span class="reviews__date">Febrero 2026</span>
      </div>

      {%- comment -%} Card 3 {%- endcomment -%}
      <div class="reviews__card animate-on-scroll" data-delay="3">
        <div class="reviews__card-top">
          <div class="reviews__avatar reviews__avatar--teal">ML</div>
          <div class="reviews__card-meta">
            <span class="reviews__name">María L.</span>
            <span class="reviews__verified">✓ Compra verificada</span>
          </div>
        </div>
        <div class="reviews__stars" aria-label="5 de 5 estrellas">
          {%- for i in (1..5) -%}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="#00B4C8" aria-hidden="true"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
          {%- endfor -%}
        </div>
        <h4 class="reviews__title">Perfecto para toda la familia</h4>
        <p class="reviews__body" data-review-body>Mi mamá lo usa para la artritis y yo después del gimnasio. La batería dura muchísimo y la pantalla LED lo hace muy fácil de usar a cualquier edad. La mejor compra del año.</p>
        <span class="reviews__date">Enero 2026</span>
      </div>

      {%- comment -%} Card 4 {%- endcomment -%}
      <div class="reviews__card animate-on-scroll" data-delay="4">
        <div class="reviews__card-top">
          <div class="reviews__avatar reviews__avatar--navy">DK</div>
          <div class="reviews__card-meta">
            <span class="reviews__name">David K.</span>
            <span class="reviews__verified">✓ Compra verificada</span>
          </div>
        </div>
        <div class="reviews__stars" aria-label="4 de 5 estrellas">
          {%- for i in (1..4) -%}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="#00B4C8" aria-hidden="true"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
          {%- endfor -%}
          <svg width="18" height="18" viewBox="0 0 24 24" fill="#E5E7EB" aria-hidden="true"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
        </div>
        <h4 class="reviews__title">Gran producto, envío rápido</h4>
        <p class="reviews__body" data-review-body>Funciona exactamente como dice. Los tres niveles de calor se sienten notablemente diferentes. Me gustaría que viniera en blanco también, pero el negro se ve muy elegante. El envío fue más rápido de lo esperado.</p>
        <span class="reviews__date">Diciembre 2025</span>
      </div>

      {%- comment -%} Card 5 {%- endcomment -%}
      <div class="reviews__card animate-on-scroll" data-delay="5">
        <div class="reviews__card-top">
          <div class="reviews__avatar reviews__avatar--teal">AP</div>
          <div class="reviews__card-meta">
            <span class="reviews__name">Ana P.</span>
            <span class="reviews__verified">✓ Compra verificada</span>
          </div>
        </div>
        <div class="reviews__stars" aria-label="5 de 5 estrellas">
          {%- for i in (1..5) -%}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="#00B4C8" aria-hidden="true"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
          {%- endfor -%}
        </div>
        <h4 class="reviews__title">El regalo perfecto</h4>
        <p class="reviews__body" data-review-body>Le regalé esto a mi abuela y no lo suelta. Dice que es lo mejor que le han dado en años. Es muy fácil de usar y el calor le alivia muchísimo las articulaciones. Totalmente recomendado.</p>
        <span class="reviews__date">Enero 2026</span>
      </div>

      {%- comment -%} Card 6 {%- endcomment -%}
      <div class="reviews__card animate-on-scroll" data-delay="6">
        <div class="reviews__card-top">
          <div class="reviews__avatar reviews__avatar--orange">CW</div>
          <div class="reviews__card-meta">
            <span class="reviews__name">Chris W.</span>
            <span class="reviews__verified">✓ Compra verificada</span>
          </div>
        </div>
        <div class="reviews__stars" aria-label="5 de 5 estrellas">
          {%- for i in (1..5) -%}
            <svg width="18" height="18" viewBox="0 0 24 24" fill="#00B4C8" aria-hidden="true"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
          {%- endfor -%}
        </div>
        <h4 class="reviews__title">Hecho para atletas</h4>
        <p class="reviews__body" data-review-body>Entreno 6 días a la semana y la fatiga del tobillo me frenaba. Ahora es innegociable en mi rutina de recuperación. La combinación calor-vibración es de nivel élite. Cero quejas.</p>
        <span class="reviews__date">Febrero 2026</span>
      </div>

    </div>

    {%- comment -%} Submit review CTA {%- endcomment -%}
    <div class="reviews__cta animate-on-scroll" data-delay="7">
      <p class="reviews__cta-text">¿VARENAL también cambió tu vida?</p>
      <a href="{{ section.settings.review_url | default: '#' }}" class="btn-varenal-secondary">
        Comparte tu experiencia →
      </a>
      <!-- 
        REVIEW APP INTEGRATION OPTIONS:
        
        OPTION A (RECOMMENDED — Free): 
          Install "Judge.me Product Reviews" from Shopify App Store.
          Replace href with your Judge.me write-review URL:
          https://judge.me/reviews/new?shop=YOUR-SHOP.myshopify.com
        
        OPTION B (Also Free): 
          Install "Loox" from Shopify App Store for photo reviews.
        
        OPTION C (No app): 
          Link button to a Google Form. Embed collected reviews manually.
          Google Form URL: create at forms.google.com with fields: Name, Stars, Title, Review.
      -->
    </div>

  </div>
</section>

{% stylesheet %}
  /* ============================================
     VARENAL REVIEWS
     ============================================ */

  .varenal-reviews {
    background: #F8F9FA;
    overflow: hidden;
  }

  /* Header */
  .reviews__header {
    text-align: center;
    margin-bottom: 40px;
  }

  .reviews__eyebrow {
    margin-bottom: 16px;
  }

  .reviews__heading {
    font-family: var(--font-heading, 'Montserrat', sans-serif);
    font-weight: 700;
    font-size: 28px;
    line-height: 1.2;
    color: var(--color-text, #2D2D2D);
    margin-top: 16px;
  }

  /* Stats bar */
  .reviews__stats {
    display: grid;
    grid-template-columns: 1fr;
    gap: 24px;
    text-align: center;
    margin-bottom: 48px;
    padding: 32px 24px;
    background: #FFFFFF;
    border-radius: 16px;
    box-shadow: 0 2px 12px rgba(0, 0, 0, 0.06);
  }

  .reviews__stat-number {
    display: block;
    font-family: var(--font-heading, 'Montserrat', sans-serif);
    font-weight: 800;
    font-size: 42px;
    color: var(--color-primary, #00B4C8);
    line-height: 1;
    margin-bottom: 8px;
  }

  .reviews__stat-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    font-family: var(--font-body, 'Inter', sans-serif);
    font-size: 14px;
    color: var(--color-text-muted, #6B7280);
  }

  .reviews__stat-stars {
    display: flex;
    gap: 2px;
  }

  /* Reviews grid */
  .reviews__grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 20px;
    margin-bottom: 48px;
  }

  /* Card */
  .reviews__card {
    background: #FFFFFF;
    border-radius: 16px;
    padding: 28px;
    box-shadow: 0 2px 16px rgba(0, 0, 0, 0.07);
    transition: all 0.3s ease;
    border-left: 3px solid transparent;
  }

  .reviews__card:hover {
    transform: translateY(-6px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
    border-left-color: var(--color-primary, #00B4C8);
  }

  .reviews__card-top {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
  }

  /* Avatar */
  .reviews__avatar {
    width: 52px;
    height: 52px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-heading, 'Montserrat', sans-serif);
    font-weight: 700;
    font-size: 16px;
    color: #FFFFFF;
    flex-shrink: 0;
    border: 2px solid var(--color-primary, #00B4C8);
  }

  .reviews__avatar--teal  { background: #00B4C8; }
  .reviews__avatar--orange { background: #FF6B35; }
  .reviews__avatar--navy  { background: #1A1A2E; }

  .reviews__card-meta {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .reviews__name {
    font-family: var(--font-body, 'Inter', sans-serif);
    font-weight: 600;
    font-size: 15px;
    color: var(--color-text, #2D2D2D);
  }

  .reviews__verified {
    font-size: 11px;
    color: var(--color-success, #10B981);
    font-weight: 600;
  }

  .reviews__stars {
    display: flex;
    gap: 2px;
    margin-bottom: 10px;
  }

  .reviews__title {
    font-family: var(--font-heading, 'Montserrat', sans-serif);
    font-weight: 700;
    font-size: 16px;
    color: var(--color-text, #2D2D2D);
    margin-bottom: 8px;
    line-height: 1.3;
  }

  .reviews__body {
    font-family: var(--font-body, 'Inter', sans-serif);
    font-size: 14px;
    line-height: 1.65;
    color: var(--color-text-muted, #6B7280);
    margin-bottom: 12px;
  }

  /* "Read more" for long reviews */
  .reviews__body.is-clamped {
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 3;
    overflow: hidden;
  }

  .reviews__read-more {
    display: inline;
    background: none;
    border: none;
    color: var(--color-primary, #00B4C8);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    padding: 0;
    font-family: var(--font-body, 'Inter', sans-serif);
  }

  .reviews__date {
    font-size: 12px;
    color: var(--color-text-muted, #6B7280);
    opacity: 0.7;
  }

  /* Submit review CTA */
  .reviews__cta {
    text-align: center;
  }

  .reviews__cta-text {
    font-size: 15px;
    color: var(--color-text-muted, #6B7280);
    margin-bottom: 12px;
  }

  /* ========== Tablet (2 columns) ========== */
  @media (min-width: 600px) {
    .reviews__grid {
      grid-template-columns: 1fr 1fr;
    }

    .reviews__stats {
      grid-template-columns: 1fr 1fr 1fr;
    }
  }

  /* ========== Desktop ========== */
  @media (min-width: 769px) {
    .reviews__heading {
      font-size: 40px;
    }

    .reviews__stat-number {
      font-size: 60px;
    }

    .reviews__grid {
      grid-template-columns: 1fr 1fr 1fr;
      gap: 24px;
    }
  }
{% endstylesheet %}

{% javascript %}
  (function() {
    'use strict';

    var section = document.getElementById('reviews');
    if (!section) return;

    /* --- CountUp animation for stats --- */
    var statsBar = document.getElementById('reviews-stats');
    var counted = false;

    function animateCountUp(el) {
      var target = parseFloat(el.getAttribute('data-count-target'));
      var suffix = el.getAttribute('data-count-suffix') || '';
      var isDecimal = el.hasAttribute('data-count-decimal');
      var decimalPlaces = isDecimal ? parseInt(el.getAttribute('data-count-decimal'), 10) : 0;
      var duration = 1500;
      var start = 0;
      var startTime = null;

      function step(timestamp) {
        if (!startTime) startTime = timestamp;
        var progress = Math.min((timestamp - startTime) / duration, 1);
        /* Ease-out cubic */
        var eased = 1 - Math.pow(1 - progress, 3);
        var current = start + (target - start) * eased;

        if (decimalPlaces > 0) {
          el.textContent = current.toFixed(decimalPlaces) + suffix;
        } else {
          el.textContent = Math.floor(current).toLocaleString('en-US') + suffix;
        }

        if (progress < 1) {
          requestAnimationFrame(step);
        }
      }

      requestAnimationFrame(step);
    }

    if (statsBar) {
      var statsObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting && !counted) {
            counted = true;
            var numbers = statsBar.querySelectorAll('[data-count-target]');
            numbers.forEach(function(num) {
              animateCountUp(num);
            });
            statsObserver.unobserve(entry.target);
          }
        });
      }, { threshold: 0.3 });

      statsObserver.observe(statsBar);
    }

    /* --- Scroll animations for cards --- */
    var scrollTargets = section.querySelectorAll('.animate-on-scroll');
    if (scrollTargets.length) {
      var cardObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            cardObserver.unobserve(entry.target);
          }
        });
      }, {
        threshold: 0.1,
        rootMargin: '0px 0px -40px 0px'
      });

      scrollTargets.forEach(function(el) {
        cardObserver.observe(el);
      });
    }

    /* --- Read more toggle for long reviews --- */
    var CHAR_LIMIT = 120;
    var reviewBodies = section.querySelectorAll('[data-review-body]');

    reviewBodies.forEach(function(body) {
      if (body.textContent.length > CHAR_LIMIT) {
        body.classList.add('is-clamped');
        var btn = document.createElement('button');
        btn.className = 'reviews__read-more';
        btn.textContent = 'Leer más';
        btn.setAttribute('aria-expanded', 'false');

        btn.addEventListener('click', function() {
          var isClamped = body.classList.contains('is-clamped');
          body.classList.toggle('is-clamped');
          btn.textContent = isClamped ? 'Leer menos' : 'Leer más';
          btn.setAttribute('aria-expanded', String(isClamped));
        });

        body.parentNode.insertBefore(btn, body.nextSibling);
      }
    });
  })();
{% endjavascript %}

{% schema %}
{
  "name": "VARENAL Reviews",
  "tag": "section",
  "class": "varenal-reviews-section",
  "settings": [
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow text",
      "default": "RESULTADOS REALES"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Únete a las 2,300+ personas que finalmente encontraron alivio"
    },
    {
      "type": "url",
      "id": "review_url",
      "label": "Submit review link"
    }
  ],
  "presets": [
    {
      "name": "VARENAL Reviews"
    }
  ]
}
{% endschema %}
