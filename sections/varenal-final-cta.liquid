{% comment %}
  VARENAL Final CTA Section
  Last conversion block before footer.
  Deep gradient background, centered content, urgency messaging.
{% endcomment %}

<section id="final-cta" class="varenal-final-cta" {{ section.shopify_attributes }}>
  {%- comment -%} Background decorations {%- endcomment -%}
  <div class="final-cta__bg-decor" aria-hidden="true">
    <div class="final-cta__glow final-cta__glow--teal"></div>
    <div class="final-cta__glow final-cta__glow--orange"></div>
    {%- comment -%} Floating heat wave SVGs {%- endcomment -%}
    <svg class="final-cta__heat-wave final-cta__heat-wave--1" width="60" height="60" viewBox="0 0 60 60" fill="none" aria-hidden="true">
      <path d="M30 5C30 5 20 15 20 25C20 32 25 38 30 42C35 38 40 32 40 25C40 15 30 5 30 5Z" stroke="rgba(255,107,53,0.15)" stroke-width="2" fill="none"/>
      <path d="M30 12C30 12 24 19 24 26C24 31 27 35 30 38C33 35 36 31 36 26C36 19 30 12 30 12Z" stroke="rgba(255,107,53,0.1)" stroke-width="1.5" fill="none"/>
    </svg>
    <svg class="final-cta__heat-wave final-cta__heat-wave--2" width="50" height="50" viewBox="0 0 60 60" fill="none" aria-hidden="true">
      <path d="M30 5C30 5 20 15 20 25C20 32 25 38 30 42C35 38 40 32 40 25C40 15 30 5 30 5Z" stroke="rgba(0,180,200,0.12)" stroke-width="2" fill="none"/>
      <path d="M30 12C30 12 24 19 24 26C24 31 27 35 30 38C33 35 36 31 36 26C36 19 30 12 30 12Z" stroke="rgba(0,180,200,0.08)" stroke-width="1.5" fill="none"/>
    </svg>
  </div>

  <div class="final-cta__container">

    {%- comment -%} Badge {%- endcomment -%}
    <div class="final-cta__badge animate-on-scroll" data-delay="0">
      <span class="varenal-badge">
        {{ section.settings.badge_text | default: 'LIMITED OFFER' }}
      </span>
    </div>

    {%- comment -%} Headline {%- endcomment -%}
    <h2 class="final-cta__heading animate-on-scroll" data-delay="1">
      {{ section.settings.headline | default: 'Your Recovery Starts Tonight.' }}
    </h2>

    {%- comment -%} Subtitle {%- endcomment -%}
    <p class="final-cta__subtitle animate-on-scroll" data-delay="2">
      {{ section.settings.subtitle | default: 'Join 2,300+ people who chose to stop enduring and start recovering. Free shipping. 60-day money-back guarantee.' }}
    </p>

    {%- comment -%} Product preview {%- endcomment -%}
    <div class="final-cta__product-preview animate-on-scroll" data-delay="3">
      <div class="final-cta__product-circle">
        {% if section.settings.product_image %}
          {{ section.settings.product_image | image_url: width: 400 | image_tag:
            class: 'final-cta__product-img',
            loading: 'lazy',
            alt: 'VARENAL Wireless Ankle Heating Pad'
          }}
        {% else %}
          <div class="final-cta__product-placeholder">
            {{ 'product-1' | placeholder_svg_tag }}
          </div>
        {% endif %}
      </div>
    </div>

    {%- comment -%} Trust pills {%- endcomment -%}
    <div class="final-cta__trust-pills animate-on-scroll" data-delay="4">
      <span class="final-cta__pill">üöö {{ section.settings.trust_1 | default: 'Free Shipping' }}</span>
      <span class="final-cta__pill">‚Ü© {{ section.settings.trust_2 | default: '60-Day Returns' }}</span>
      <span class="final-cta__pill">üîí {{ section.settings.trust_3 | default: 'Secure Payment' }}</span>
    </div>

    {%- comment -%} CTA button {%- endcomment -%}
    <div class="final-cta__action animate-on-scroll" data-delay="5">
      <a
        href="{{ section.settings.cta_url | default: '#' }}"
        class="btn-varenal-primary final-cta__btn"
        id="final-cta-btn"
      >
        {{ section.settings.cta_text | default: 'Get My VARENAL Now' }}
      </a>
      <p class="final-cta__urgency">‚ö° Normalmente se env√≠a en 24 horas</p>
    </div>

  </div>
</section>

{% stylesheet %}
  /* ============================================
     VARENAL FINAL CTA
     ============================================ */

  .varenal-final-cta {
    position: relative;
    background: linear-gradient(180deg, #1A1A2E 0%, #0D2333 100%);
    padding: 80px 20px;
    overflow: hidden;
    text-align: center;
  }

  /* Background decorations */
  .final-cta__bg-decor {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
  }

  .final-cta__glow {
    position: absolute;
    width: 400px;
    height: 400px;
    border-radius: 50%;
    filter: blur(100px);
    opacity: 0.08;
  }

  .final-cta__glow--teal {
    background: #00B4C8;
    top: -100px;
    right: -100px;
  }

  .final-cta__glow--orange {
    background: #FF6B35;
    bottom: -100px;
    left: -100px;
  }

  /* Floating heat wave icons */
  .final-cta__heat-wave {
    position: absolute;
    opacity: 0.5;
  }

  .final-cta__heat-wave--1 {
    top: 15%;
    left: 8%;
    animation: heatWave 3s ease-in-out infinite;
  }

  .final-cta__heat-wave--2 {
    bottom: 20%;
    right: 10%;
    animation: heatWave 3s ease-in-out 1.5s infinite;
  }

  /* Container */
  .final-cta__container {
    position: relative;
    z-index: 1;
    max-width: 600px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
  }

  /* Heading */
  .final-cta__heading {
    font-family: var(--font-heading, 'Montserrat', sans-serif);
    font-weight: 800;
    font-size: 28px;
    line-height: 1.15;
    color: #FFFFFF;
  }

  /* Subtitle */
  .final-cta__subtitle {
    font-family: var(--font-body, 'Inter', sans-serif);
    font-size: 16px;
    line-height: 1.6;
    color: rgba(255, 255, 255, 0.6);
    max-width: 500px;
  }

  /* Product preview */
  .final-cta__product-circle {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid var(--color-primary, #00B4C8);
    box-shadow: 0 0 40px rgba(255, 107, 53, 0.2), 0 0 20px rgba(0, 180, 200, 0.15);
    background: rgba(26, 26, 46, 0.6);
  }

  .final-cta__product-img,
  .final-cta__product-placeholder {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .final-cta__product-placeholder svg {
    width: 100%;
    height: 100%;
  }

  /* Trust pills */
  .final-cta__trust-pills {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
  }

  .final-cta__pill {
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.85);
    font-family: var(--font-body, 'Inter', sans-serif);
    font-size: 13px;
    font-weight: 500;
    padding: 8px 16px;
    border-radius: 999px;
    white-space: nowrap;
  }

  /* CTA button */
  .final-cta__btn {
    font-size: 18px !important;
    padding: 16px 40px !important;
    height: auto !important;
    width: 100%;
    max-width: 320px;
  }

  .final-cta__btn.pulse-glow {
    animation: pulseGlow 2.5s infinite;
  }

  /* Urgency line */
  .final-cta__urgency {
    font-family: var(--font-body, 'Inter', sans-serif);
    font-size: 14px;
    color: rgba(255, 255, 255, 0.5);
    margin-top: -8px;
  }

  /* ========== Desktop ========== */
  @media (min-width: 769px) {
    .varenal-final-cta {
      padding: 100px 40px;
    }

    .final-cta__heading {
      font-size: 44px;
    }

    .final-cta__subtitle {
      font-size: 18px;
    }

    .final-cta__btn {
      width: auto;
    }
  }
{% endstylesheet %}

{% javascript %}
  (function() {
    'use strict';

    var section = document.getElementById('final-cta');
    if (!section) return;

    /* Scroll animations */
    var targets = section.querySelectorAll('.animate-on-scroll');

    if (targets.length) {
      var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      }, {
        threshold: 0.15,
        rootMargin: '0px 0px -40px 0px'
      });

      targets.forEach(function(el) {
        observer.observe(el);
      });
    }

    /* Pulse glow on CTA button after 1.5s delay when visible */
    var ctaBtn = document.getElementById('final-cta-btn');
    if (ctaBtn) {
      var btnObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            setTimeout(function() {
              ctaBtn.classList.add('pulse-glow');
            }, 1500);
            btnObserver.unobserve(entry.target);
          }
        });
      }, { threshold: 0.5 });

      btnObserver.observe(ctaBtn);
    }
  })();
{% endjavascript %}

{% schema %}
{
  "name": "VARENAL Final CTA",
  "tag": "section",
  "class": "varenal-final-cta-section",
  "settings": [
    {
      "type": "text",
      "id": "badge_text",
      "label": "Badge text",
      "default": "OFERTA LIMITADA"
    },
    {
      "type": "text",
      "id": "headline",
      "label": "Headline",
      "default": "Tu recuperaci√≥n empieza esta noche."
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Subtitle",
      "default": "√önete a las 2,300+ personas que decidieron dejar de aguantar y empezar a recuperarse. Env√≠o gratis. Garant√≠a de devoluci√≥n de 60 d√≠as."
    },
    {
      "type": "image_picker",
      "id": "product_image",
      "label": "Product image"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "CTA button text",
      "default": "Quiero mi VARENAL ahora"
    },
    {
      "type": "url",
      "id": "cta_url",
      "label": "CTA link"
    },
    {
      "type": "text",
      "id": "trust_1",
      "label": "Trust pill 1",
      "default": "Env√≠o gratis"
    },
    {
      "type": "text",
      "id": "trust_2",
      "label": "Trust pill 2",
      "default": "60 d√≠as de devoluci√≥n"
    },
    {
      "type": "text",
      "id": "trust_3",
      "label": "Trust pill 3",
      "default": "Pago seguro"
    }
  ],
  "presets": [
    {
      "name": "VARENAL Final CTA"
    }
  ]
}
{% endschema %}
