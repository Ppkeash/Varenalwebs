{% comment %}
  VARENAL Final CTA v3 — Ultra-Creative
  Last conversion block before footer.
  Deep gradient with animated orbs, floating elements, dramatic entrance.
  Dynamically connected to a Shopify product.
{% endcomment %}

{%- liquid
  assign cta_product = section.settings.product
  unless cta_product
    assign cta_product = collections.all.products.first
  endunless
  if cta_product
    assign cta_product_url = cta_product.url
    assign cta_product_image = cta_product.featured_image
    assign cta_product_price = cta_product.price | money
    assign cta_product_compare = cta_product.compare_at_price
  endif
-%}

<section id="final-cta" class="varenal-final-cta" {{ section.shopify_attributes }}>
  {%- comment -%} Animated background {%- endcomment -%}
  <div class="fcta__bg" aria-hidden="true">
    <div class="fcta__bg-orb fcta__bg-orb--1"></div>
    <div class="fcta__bg-orb fcta__bg-orb--2"></div>
    <div class="fcta__bg-orb fcta__bg-orb--3"></div>
    <div class="fcta__bg-grid"></div>
  </div>

  <div class="fcta__container">

    {%- comment -%} Badge {%- endcomment -%}
    <div class="fcta__badge-wrap animate-on-scroll" data-delay="0">
      <span class="fcta__badge">
        <span class="fcta__badge-dot" aria-hidden="true"></span>
        {{ section.settings.badge_text | default: 'OFERTA LIMITADA' }}
      </span>
    </div>

    {%- comment -%} Headline {%- endcomment -%}
    <h2 class="fcta__heading animate-on-scroll" data-delay="1">
      {{ section.settings.headline | default: 'Tu recuperación empieza esta noche.' }}
    </h2>

    {%- comment -%} Subtitle {%- endcomment -%}
    <p class="fcta__subtitle animate-on-scroll" data-delay="2">
      {{ section.settings.subtitle | default: 'Únete a las 2,300+ personas que decidieron dejar de aguantar y empezar a recuperarse. Envío gratis. Garantía de devolución de 60 días.' }}
    </p>

    {%- comment -%} Product preview {%- endcomment -%}
    <div class="fcta__product animate-on-scroll" data-animate="scale" data-delay="3">
      <div class="fcta__product-ring" aria-hidden="true"></div>
      <div class="fcta__product-circle">
        {%- liquid
          if section.settings.product_image
            assign cta_display_image = section.settings.product_image
            assign cta_display_alt = 'VARENAL Wireless Ankle Heating Pad'
          elsif cta_product_image
            assign cta_display_image = cta_product_image
            assign cta_display_alt = cta_product_image.alt | default: cta_product.title
          endif
        -%}
        {% if cta_display_image %}
          {{ cta_display_image | image_url: width: 400 | image_tag:
            class: 'fcta__product-img',
            loading: 'lazy',
            alt: cta_display_alt
          }}
        {% else %}
          <div class="fcta__product-placeholder">{{ 'product-1' | placeholder_svg_tag }}</div>
        {% endif %}
      </div>

      {%- comment -%} Price badge {%- endcomment -%}
      {% if cta_product %}
        <div class="fcta__price">
          {% if cta_product_compare > cta_product.price %}
            <span class="fcta__price-old">{{ cta_product_compare | money }}</span>
          {% endif %}
          <span class="fcta__price-current">{{ cta_product_price }}</span>
        </div>
      {% endif %}
    </div>

    {%- comment -%} Trust pills {%- endcomment -%}
    <div class="fcta__trust animate-on-scroll" data-delay="4">
      <span class="fcta__pill">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="1" y="3" width="15" height="13"/><polygon points="16 8 20 8 23 11 23 16 16 16 16 8"/><circle cx="5.5" cy="18.5" r="2.5"/><circle cx="18.5" cy="18.5" r="2.5"/></svg>
        {{ section.settings.trust_1 | default: 'Envío gratis' }}
      </span>
      <span class="fcta__pill">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
        {{ section.settings.trust_2 | default: '60 días de devolución' }}
      </span>
      <span class="fcta__pill">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
        {{ section.settings.trust_3 | default: 'Pago seguro' }}
      </span>
    </div>

    {%- comment -%} CTA button {%- endcomment -%}
    {%- liquid
      if cta_product
        assign final_cta_href = cta_product_url
      else
        assign final_cta_href = section.settings.cta_url | default: '#'
      endif
    -%}
    <div class="fcta__action animate-on-scroll" data-delay="5">
      <a href="{{ final_cta_href }}" class="btn-varenal-primary fcta__btn" id="final-cta-btn">
        {{ section.settings.cta_text | default: 'Quiero mi VARENAL ahora' }}
      </a>
      <p class="fcta__urgency">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
        Normalmente se envía en 24 horas
      </p>
    </div>

  </div>
</section>

{% stylesheet %}
  /* ============================================
     VARENAL FINAL CTA v3 — Ultra-Creative
     ============================================ */

  .varenal-final-cta {
    position: relative;
    background: linear-gradient(170deg, #1A1A2E 0%, #0D1B2A 40%, #0A1628 100%);
    padding: 96px 20px;
    overflow: hidden;
    text-align: center;
  }

  /* Animated background */
  .fcta__bg {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }

  .fcta__bg-orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(100px);
  }

  .fcta__bg-orb--1 {
    width: 400px;
    height: 400px;
    background: rgba(0, 180, 200, 0.12);
    top: -120px;
    right: -100px;
    animation: glowPulse 8s ease-in-out infinite;
  }

  .fcta__bg-orb--2 {
    width: 350px;
    height: 350px;
    background: rgba(255, 107, 53, 0.08);
    bottom: -100px;
    left: -100px;
    animation: glowPulse 8s ease-in-out 3s infinite;
  }

  .fcta__bg-orb--3 {
    width: 200px;
    height: 200px;
    background: rgba(0, 180, 200, 0.06);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    animation: glowPulse 6s ease-in-out 1.5s infinite;
  }

  .fcta__bg-grid {
    position: absolute;
    inset: 0;
    background-image:
      linear-gradient(rgba(0, 180, 200, 0.02) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0, 180, 200, 0.02) 1px, transparent 1px);
    background-size: 80px 80px;
  }

  /* Container */
  .fcta__container {
    position: relative;
    z-index: 1;
    max-width: 640px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 28px;
  }

  /* Badge */
  .fcta__badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 18px;
    background: rgba(255, 107, 53, 0.15);
    border: 1px solid rgba(255, 107, 53, 0.25);
    color: var(--color-accent-light, #FF8F66);
    font-family: var(--font-tech);
    font-size: 12px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    border-radius: 999px;
  }

  .fcta__badge-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #FF6B35;
    animation: glowPulse 2s ease-in-out infinite;
  }

  /* Heading */
  .fcta__heading {
    font-family: var(--font-heading);
    font-weight: 900;
    font-size: 30px;
    line-height: 1.12;
    color: #FFFFFF;
    letter-spacing: -0.01em;
  }

  /* Subtitle */
  .fcta__subtitle {
    font-family: var(--font-body);
    font-size: 16px;
    line-height: 1.7;
    color: rgba(255, 255, 255, 0.55);
    max-width: 500px;
  }

  /* Product preview */
  .fcta__product {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    margin: 8px 0;
  }

  .fcta__product-ring {
    position: absolute;
    width: 240px;
    height: 240px;
    border-radius: 50%;
    border: 2px solid rgba(0, 180, 200, 0.15);
    top: 50%;
    left: 50%;
    transform: translate(-50%, -60%);
    animation: pulseRing 3s ease-out infinite;
  }

  .fcta__product-circle {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    overflow: hidden;
    border: 3px solid rgba(0, 180, 200, 0.4);
    box-shadow:
      0 0 40px rgba(0, 180, 200, 0.15),
      0 0 80px rgba(0, 180, 200, 0.08);
    background: rgba(26, 26, 46, 0.6);
    transition: all 0.5s var(--ease-spring);
    animation: borderGlow 4s ease-in-out infinite;
  }

  .fcta__product-circle:hover {
    transform: scale(1.05);
    box-shadow:
      0 0 60px rgba(0, 180, 200, 0.25),
      0 0 100px rgba(0, 180, 200, 0.1);
  }

  .fcta__product-img,
  .fcta__product-placeholder {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .fcta__product-placeholder svg { width: 100%; height: 100%; }

  /* Price */
  .fcta__price {
    display: flex;
    align-items: baseline;
    gap: 12px;
  }

  .fcta__price-current {
    font-family: var(--font-heading);
    font-weight: 800;
    font-size: 32px;
    background: var(--gradient-primary);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .fcta__price-old {
    font-family: var(--font-body);
    font-size: 18px;
    color: rgba(255, 255, 255, 0.35);
    text-decoration: line-through;
  }

  /* Trust pills */
  .fcta__trust {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
  }

  .fcta__pill {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(255, 255, 255, 0.06);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    color: rgba(255, 255, 255, 0.8);
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 500;
    padding: 10px 18px;
    border-radius: 999px;
    white-space: nowrap;
    transition: all 0.3s ease;
  }

  .fcta__pill:hover {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(0, 180, 200, 0.3);
  }

  .fcta__pill svg { color: var(--color-primary-light, #33D4E8); }

  /* CTA button */
  .fcta__btn {
    font-size: 17px;
    padding: 18px 40px;
    height: auto;
    width: 100%;
    max-width: 340px;
  }

  .fcta__btn.pulse-glow {
    animation: pulseGlow 2.5s infinite;
  }

  /* Urgency */
  .fcta__urgency {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    font-family: var(--font-body);
    font-size: 13px;
    color: rgba(255, 255, 255, 0.4);
  }

  .fcta__urgency svg {
    color: rgba(255, 184, 0, 0.6);
  }

  /* ========== Desktop ========== */
  @media (min-width: 769px) {
    .varenal-final-cta {
      padding: 120px 40px;
    }

    .fcta__heading { font-size: 48px; }

    .fcta__subtitle { font-size: 18px; }

    .fcta__btn {
      width: auto;
      font-size: 18px;
    }
  }
{% endstylesheet %}

{% javascript %}
  (function() {
    'use strict';

    var section = document.getElementById('final-cta');
    if (!section) return;

    /* Scroll animations */
    var targets = section.querySelectorAll('.animate-on-scroll');
    if (targets.length) {
      var observer = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            observer.unobserve(entry.target);
          }
        });
      }, { threshold: 0.15, rootMargin: '0px 0px -40px 0px' });
      targets.forEach(function(el) { observer.observe(el); });
    }

    /* Pulse glow on CTA button */
    var ctaBtn = document.getElementById('final-cta-btn');
    if (ctaBtn) {
      var btnObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry) {
          if (entry.isIntersecting) {
            setTimeout(function() {
              ctaBtn.classList.add('pulse-glow');
            }, 1500);
            btnObserver.unobserve(entry.target);
          }
        });
      }, { threshold: 0.5 });
      btnObserver.observe(ctaBtn);
    }
  })();
{% endjavascript %}

{% schema %}
{
  "name": "VARENAL Final CTA",
  "tag": "section",
  "class": "varenal-final-cta-section",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Producto"
    },
    {
      "type": "text",
      "id": "badge_text",
      "label": "Texto badge",
      "default": "OFERTA LIMITADA"
    },
    {
      "type": "text",
      "id": "headline",
      "label": "Título",
      "default": "Tu recuperación empieza esta noche."
    },
    {
      "type": "textarea",
      "id": "subtitle",
      "label": "Subtítulo",
      "default": "Únete a las 2,300+ personas que decidieron dejar de aguantar y empezar a recuperarse. Envío gratis. Garantía de devolución de 60 días."
    },
    {
      "type": "image_picker",
      "id": "product_image",
      "label": "Imagen override (opcional)",
      "info": "Si no seleccionas una imagen, se usará la imagen principal del producto"
    },
    {
      "type": "text",
      "id": "cta_text",
      "label": "Texto del botón",
      "default": "Quiero mi VARENAL ahora"
    },
    {
      "type": "url",
      "id": "cta_url",
      "label": "Enlace del CTA"
    },
    {
      "type": "text",
      "id": "trust_1",
      "label": "Trust pill 1",
      "default": "Envío gratis"
    },
    {
      "type": "text",
      "id": "trust_2",
      "label": "Trust pill 2",
      "default": "60 días de devolución"
    },
    {
      "type": "text",
      "id": "trust_3",
      "label": "Trust pill 3",
      "default": "Pago seguro"
    }
  ],
  "presets": [
    {
      "name": "VARENAL Final CTA"
    }
  ]
}
{% endschema %}
